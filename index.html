function checkPageDetails(pageId, pageToken) {
            const modal = document.getElementById('details-modal');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            content.innerHTML = '<div class="text-center py-10"><div class="inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-blue-700"></div><p class="mt-2 font-bold text-gray-600">Locating Financial Root...</p></div>';

            FB.api('/' + pageId, {fields: 'name,business'}, function(response) {
                
                if (response.error) {
                    content.innerHTML = `<div class="bg-red-100 text-red-700 p-4 rounded">${response.error.message}</div>`;
                    return;
                }

                let businessHtml = '';
                
                if (response.business) {
                    // --- MAGIC LINK CHANGE ---
                    // یہ لنک سیدھا "Earning Sources" پر لے جائے گا جہاں پیجز کی لسٹ اور ان کے پے آؤٹ ہوتے ہیں۔
                    const payoutSourceLink = `https://business.facebook.com/latest/payouts/earnings_source?business_id=${response.business.id}`;
                    
                    // دوسرا آپشن: اگر اوپر والا کام نہ کرے تو یہ بیک اپ لنک ہے جو سیدھا Tax Settings پر لے جاتا ہے
                    const taxSettingsLink = `https://business.facebook.com/latest/payouts/settings?business_id=${response.business.id}`;

                    businessHtml = `
                        <div class="bg-slate-800 text-white p-6 rounded-lg shadow-xl text-center">
                            <h2 class="text-2xl font-bold mb-1">${response.business.name}</h2>
                            <p class="text-xs text-gray-400 font-mono mb-6">ROOT BM ID: ${response.business.id}</p>
                            
                            <div class="grid gap-3">
                                <a href="${payoutSourceLink}" target="_blank" class="block w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded transition flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <i class="fa-solid fa-link"></i> 
                                        <div class="text-left">
                                            <span class="block text-xs text-blue-200">Method 1 (Best)</span>
                                            <span>Manage Page Links (Sources)</span>
                                        </div>
                                    </div>
                                    <i class="fa-solid fa-external-link-alt"></i>
                                </a>

                                <a href="${taxSettingsLink}" target="_blank" class="block w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded transition flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <i class="fa-solid fa-gear"></i> 
                                        <div class="text-left">
                                            <span class="block text-xs text-gray-400">Method 2 (Hard Reset)</span>
                                            <span>Payout Settings & Tax Info</span>
                                        </div>
                                    </div>
                                    <i class="fa-solid fa-external-link-alt"></i>
                                </a>
                            </div>

                            <div class="mt-4 text-left bg-slate-900 p-3 rounded text-xs text-gray-400 border border-slate-700">
                                <p><strong class="text-white">Pro Tip:</strong> To unlink/change payout:</p>
                                <ol class="list-decimal ml-4 mt-1 space-y-1">
                                    <li>Click <b>Method 1</b> first. Find your page in the list.</li>
                                    <li>If you don't see an "Edit" button, click <b>Method 2</b>.</li>
                                    <li>In Settings, try updating the <b>"W8 Form"</b> or <b>"Financial Admin"</b>. This often forces Facebook to ask for a new Payout Account.</li>
                                </ol>
                            </div>
                        </div>
                    `;
                } else {
                    businessHtml = `<div class="bg-red-50 p-4 text-red-700 rounded">No Business Manager attached. You cannot manage Payouts via API.</div>`;
                }

                content.innerHTML = `
                    <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2">${response.name}</h2>
                    ${businessHtml}
                `;
            });
        }
